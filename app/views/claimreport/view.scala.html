@import utilities.Alert

@(claim:Claim, files: List[Map[String,String]], alert:Alert=null)(implicit flash: Flash, session: play.api.mvc.Session)

@pageheader = {
	<div class="page-header">
		<h1>Claim Reports <small><i class="ace-icon fa fa-angle-double-right"></i> Claim <i class="ace-icon fa fa-angle-double-right"></i> @claim.p.n</small></h1>
	</div>
}

@pluginjs = {}

@inlinejs = {
	<script>
		let path = '@session.get("path").get';
	</script>
	<script src="@routes.Assets.at("javascripts/claimreport.view.js")" type="text/javascript"></script>
	<script src="@routes.Assets.at("javascripts/common.auditlog.js")" type="text/javascript"></script>
}

@pluginstyle = {}

@inlinestyle = {}

@buttons = {
	@if(claim.wf.papr.id==session.get("id").get) {
		<a href="@routes.ClaimController.approve(claim._id.stringify)" class="btn btn-sm btn-block">Approve</a>	
		<a href="@routes.ClaimController.reject(claim._id.stringify)" class="btn btn-sm btn-block">Reject</a>
	}
	@if(claim.wf.wfs!="End" && (session.get("id").get==claim.p.id || session.get("roles").get.contains("Admin"))) {
		<a href="@routes.ClaimController.cancel(claim._id.stringify)" class="btn btn-sm btn-block">Cancel Claim</a>
	}
	<a href="javascript:displayAuditLog('@claim._id.stringify')" class="btn btn-sm btn-block">Audit Log</a>
	<a href="javascript:history.back()" class="btn btn-sm btn-block">Back</a>	
}

@contentRow(label: String, contentVal: String, cssClass:String="") = {
	@if(contentVal.trim() == "") {
		<dl class="dl-horizontal"><dt><label>@label</label></dt><dd class="@cssClass">&nbsp;</dd></dl>
	} else {
		<dl class="dl-horizontal"><dt><label>@label</label></dt><dd class="@cssClass">@contentVal</dd></dl>
	}
}

@layout.ace.main93(session.get("company").get + " - HRSifu",pageheader,pluginjs,inlinejs,pluginstyle,inlinestyle,buttons) {
	@layout.ace.alert(alert)

	<div class="tabbable">
		<ul class="nav nav-tabs" id="myTab">
			<li class="active">
				<a data-toggle="tab" href="#home">
					Claim Details
				</a>
			</li>
			<li class="">
				<a data-toggle="tab" href="#messages">
					Workflow
				</a>
			</li>
		</ul>
	
		<div class="tab-content">
			<div id="home" class="tab-pane fade active in">
				@contentRow("Doc Num", claim.docnum.toString())
				@contentRow("Applicant", claim.p.n)
				@contentRow("Status", claim.wf.s)
				@if(claim.wf.papr.n!="") { @contentRow("Pending Approver(s)", claim.wf.papr.n) }
				@contentRow("Category", claim.ed.cat)
				@contentRow("Receipt  Date", claim.ed.rdat.get.dayOfMonth().getAsText + "-" + claim.ed.rdat.get.monthOfYear().getAsShortText + "-" + claim.ed.rdat.get.getYear.toString())
				@contentRow("Amount", claim.ed.amt.ccy + " " + claim.ed.amt.amt.toString)
				@contentRow("Exchange Rate", claim.ed.er.toString)
				@contentRow("Approve Amount", claim.ed.aamt.ccy + " " + claim.ed.aamt.amt.toString)
				@contentRow("GST / VAT", claim.ed.gstamt.tamt.ccy + " " + claim.ed.gstamt.tamt.amt.toString)
				@if(claim.ed.gstamt.cn!=""){
					@contentRow("Tax Company Name", claim.ed.gstamt.cn)
				}
				@if(claim.ed.gstamt.crnum!=""){
					@contentRow("Tax Company Reg. No", claim.ed.gstamt.crnum)
				}
				@if(claim.ed.gstamt.tnum!=""){
					@contentRow("GST / VAT Reg. No", claim.ed.gstamt.tnum)
				}
				<dl class="dl-horizontal"><dt><label>Description</label></dt><dd>@Html(claim.ed.d)</dd></dl>
				@if(files.length!=0){
					<dl class="dl-horizontal">
						<dt><label>Receipt(s)</label></dt>
						<dd>
							@files.map { file => @file.map { x => 
									<p id="@x._1"><a href='/claimfile/view?p_id=@x._1' target='_blank'>@x._2</a></p>
							} }
						</dd>
					</dl>
				}
			</div>
				
			<div id="messages" class="tab-pane fade">
				<div class="table-responsive">
					<table id="leavetable" class="table table-striped table-bordered table-hover">
						<thead><tr>
							<th class="text-center">#</th>
							<th class="text-center">Status</th>
							<th class="text-center">Assigned To</th>
							<th class="text-center">Action</th>
							<th class="text-center">Date of Action</th>
						</tr></thead>
							@if(claim.wfs.s1!=""){
    							<tr>
    								<td class="text-center">1</td>
      								<td class="text-center">@claim.wfs.s1</td>
      								<td class="text-center">@claim.wfat.at1.n</td>
      								<td class="text-center">@claim.wfa.a1</td>
      								<td class="text-center">
      									@if(!claim.wdadat.ad1.isEmpty) {
      										@(claim.wdadat.ad1.get.dayOfMonth().getAsText + "-" + claim.wdadat.ad1.get.monthOfYear().getAsShortText + "-" + claim.wdadat.ad1.get.getYear.toString() + " " + claim.wdadat.ad1.get.hourOfDay().getAsShortText + ":" + claim.wdadat.ad1.get.minuteOfHour().getAsShortText + ":" + claim.wdadat.ad1.get.secondOfMinute().getAsShortText)
      									}
      								</td>
      							</tr>
							}
							@if(claim.wfs.s2!=""){
    							<tr>
    								<td class="text-center">2</td>
      								<td class="text-center">@claim.wfs.s2</td>
      								<td class="text-center">@claim.wfat.at2.n</td>
      								<td class="text-center">@claim.wfa.a2</td>
      								<td class="text-center">
      									@if(!claim.wdadat.ad2.isEmpty) {
      										@(claim.wdadat.ad2.get.dayOfMonth().getAsText + "-" + claim.wdadat.ad2.get.monthOfYear().getAsShortText + "-" + claim.wdadat.ad2.get.getYear.toString() + " " + claim.wdadat.ad2.get.hourOfDay().getAsShortText + ":" + claim.wdadat.ad2.get.minuteOfHour().getAsShortText + ":" + claim.wdadat.ad2.get.secondOfMinute().getAsShortText)
      									}
      								</td>
      							</tr>
							}
							@if(claim.wfs.s3!=""){
    							<tr>
    								<td class="text-center">3</td>
      								<td class="text-center">@claim.wfs.s3</td>
      								<td class="text-center">@claim.wfat.at3.n</td>
      								<td class="text-center">@claim.wfa.a3</td>
      								<td class="text-center">
      									@if(!claim.wdadat.ad3.isEmpty) {
      										@(claim.wdadat.ad3.get.dayOfMonth().getAsText + "-" + claim.wdadat.ad3.get.monthOfYear().getAsShortText + "-" + claim.wdadat.ad3.get.getYear.toString() + " " + claim.wdadat.ad3.get.hourOfDay().getAsShortText + ":" + claim.wdadat.ad3.get.minuteOfHour().getAsShortText + ":" + claim.wdadat.ad3.get.secondOfMinute().getAsShortText)
      									}
      								</td>
      							</tr>
							}
							@if(claim.wfs.s4!=""){
    							<tr>
    								<td class="text-center">4</td>
      								<td class="text-center">@claim.wfs.s4</td>
      								<td class="text-center">@claim.wfat.at4.n</td>
      								<td class="text-center">@claim.wfa.a4</td>
      								<td class="text-center">
      									@if(!claim.wdadat.ad4.isEmpty) {
      										@(claim.wdadat.ad4.get.dayOfMonth().getAsText + "-" + claim.wdadat.ad4.get.monthOfYear().getAsShortText + "-" + claim.wdadat.ad4.get.getYear.toString() + " " + claim.wdadat.ad4.get.hourOfDay().getAsShortText + ":" + claim.wdadat.ad4.get.minuteOfHour().getAsShortText + ":" + claim.wdadat.ad4.get.secondOfMinute().getAsShortText)
      									}
      								</td>
      							</tr>
							}
							@if(claim.wfs.s5!=""){
    							<tr>
    								<td class="text-center">5</td>
      								<td class="text-center">@claim.wfs.s5</td>
      								<td class="text-center">@claim.wfat.at5.n</td>
      								<td class="text-center">@claim.wfa.a5</td>
      								<td class="text-center">
      									@if(!claim.wdadat.ad5.isEmpty) {
      										@(claim.wdadat.ad5.get.dayOfMonth().getAsText + "-" + claim.wdadat.ad5.get.monthOfYear().getAsShortText + "-" + claim.wdadat.ad5.get.getYear.toString() + " " + claim.wdadat.ad5.get.hourOfDay().getAsShortText + ":" + claim.wdadat.ad5.get.minuteOfHour().getAsShortText + ":" + claim.wdadat.ad5.get.secondOfMinute().getAsShortText)
      									}
      								</td>
      							</tr>
							}
							@if(claim.wfs.s6!=""){
    							<tr>
    								<td class="text-center">6</td>
      								<td class="text-center">@claim.wfs.s6</td>
      								<td class="text-center">@claim.wfat.at6.n</td>
      								<td class="text-center">@claim.wfa.a6</td>
      								<td class="text-center">
      									@if(!claim.wdadat.ad6.isEmpty) {
      										@(claim.wdadat.ad6.get.dayOfMonth().getAsText + "-" + claim.wdadat.ad6.get.monthOfYear().getAsShortText + "-" + claim.wdadat.ad6.get.getYear.toString() + " " + claim.wdadat.ad6.get.hourOfDay().getAsShortText + ":" + claim.wdadat.ad6.get.minuteOfHour().getAsShortText + ":" + claim.wdadat.ad6.get.secondOfMinute().getAsShortText)
      									}
      								</td>
      							</tr>
							}
							@if(claim.wfs.s7!=""){
    							<tr>
    								<td class="text-center">7</td>
      								<td class="text-center">@claim.wfs.s7</td>
      								<td class="text-center">@claim.wfat.at7.n</td>
      								<td class="text-center">@claim.wfa.a7</td>
      								<td class="text-center">
      									@if(!claim.wdadat.ad7.isEmpty) {
      										@(claim.wdadat.ad7.get.dayOfMonth().getAsText + "-" + claim.wdadat.ad7.get.monthOfYear().getAsShortText + "-" + claim.wdadat.ad7.get.getYear.toString() + " " + claim.wdadat.ad7.get.hourOfDay().getAsShortText + ":" + claim.wdadat.ad7.get.minuteOfHour().getAsShortText + ":" + claim.wdadat.ad7.get.secondOfMinute().getAsShortText)
      									}
      								</td>
      							</tr>
							}
							@if(claim.wfs.s8!=""){
    							<tr>
    								<td class="text-center">8</td>
      								<td class="text-center">@claim.wfs.s8</td>
      								<td class="text-center">@claim.wfat.at8.n</td>
      								<td class="text-center">@claim.wfa.a8</td>
      								<td class="text-center">
      									@if(!claim.wdadat.ad8.isEmpty) {
      										@(claim.wdadat.ad8.get.dayOfMonth().getAsText + "-" + claim.wdadat.ad8.get.monthOfYear().getAsShortText + "-" + claim.wdadat.ad8.get.getYear.toString() + " " + claim.wdadat.ad8.get.hourOfDay().getAsShortText + ":" + claim.wdadat.ad8.get.minuteOfHour().getAsShortText + ":" + claim.wdadat.ad8.get.secondOfMinute().getAsShortText)
      									}
      								</td>
      							</tr>
							}
							@if(claim.wfs.s9!=""){
    							<tr>
    								<td class="text-center">9</td>
      								<td class="text-center">@claim.wfs.s9</td>
      								<td class="text-center">@claim.wfat.at9.n</td>
      								<td class="text-center">@claim.wfa.a9</td>
      								<td class="text-center">
      									@if(!claim.wdadat.ad9.isEmpty) {
      										@(claim.wdadat.ad9.get.dayOfMonth().getAsText + "-" + claim.wdadat.ad9.get.monthOfYear().getAsShortText + "-" + claim.wdadat.ad9.get.getYear.toString() + " " + claim.wdadat.ad9.get.hourOfDay().getAsShortText + ":" + claim.wdadat.ad9.get.minuteOfHour().getAsShortText + ":" + claim.wdadat.ad9.get.secondOfMinute().getAsShortText)
      									}
      								</td>
      							</tr>
							}
							@if(claim.wfs.s10!=""){
    							<tr>
    								<td class="text-center">10</td>
      								<td class="text-center">@claim.wfs.s10</td>
      								<td class="text-center">@claim.wfat.at10.n</td>
      								<td class="text-center">@claim.wfa.a10</td>
      								<td class="text-center">
      									@if(!claim.wdadat.ad10.isEmpty) {
      										@(claim.wdadat.ad10.get.dayOfMonth().getAsText + "-" + claim.wdadat.ad10.get.monthOfYear().getAsShortText + "-" + claim.wdadat.ad10.get.getYear.toString() + " " + claim.wdadat.ad10.get.hourOfDay().getAsShortText + ":" + claim.wdadat.ad10.get.minuteOfHour().getAsShortText + ":" + claim.wdadat.ad10.get.secondOfMinute().getAsShortText)
      									}
      								</td>
      							</tr>
							}
						<tbody>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>

}